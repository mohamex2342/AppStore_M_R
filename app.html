<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل التطبيق - App Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border: #334155;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background: var(--bg-dark);
            min-height: 100vh;
            color: var(--text-primary);
        }
        
        .glass-effect {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
            transform: scale(1.02);
        }
        
        .loading-spinner {
            border: 3px solid rgba(59, 130, 246, 0.1);
            border-radius: 50%;
            border-top: 3px solid var(--primary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hero-pattern {
            background-image: radial-gradient(circle at 1px 1px, rgba(59, 130, 246, 0.1) 1px, transparent 0);
            background-size: 40px 40px;
        }
        
        .screenshot-container {
            position: relative;
            overflow: hidden;
        }
        
        .screenshot-container::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, transparent 60%, rgba(15, 23, 42, 0.9) 100%);
        }
        
        .icon-container {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }
        
        .feature-icon {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }
        
        .info-card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--border);
        }
        
        .badge {
            background: rgba(59, 130, 246, 0.15);
            color: var(--primary-light);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .badge-secondary {
            background: rgba(139, 92, 246, 0.15);
            color: #a78bfa;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        
        /* Progress Bar */
        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        /* Rating Distribution */
        .rating-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .rating-stars {
            min-width: 60px;
            color: #fbbf24;
            font-size: 0.9rem;
        }
        
        .rating-progress {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .rating-fill {
            height: 100%;
            background: #fbbf24;
            border-radius: 4px;
        }
        
        /* Screenshot Gallery */
        .screenshot-gallery {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--bg-card);
        }
        
        .screenshot-gallery::-webkit-scrollbar {
            height: 6px;
        }
        
        .screenshot-gallery::-webkit-scrollbar-track {
            background: var(--bg-card);
            border-radius: 3px;
        }
        
        .screenshot-gallery::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
        
        .screenshot-thumb {
            min-width: 200px;
            height: 120px;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .screenshot-thumb:hover, .screenshot-thumb.active {
            border-color: var(--primary);
            transform: scale(1.05);
        }
        
        /* Similar Apps */
        .similar-app-card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .similar-app-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }
        
        /* Share Buttons */
        .share-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            transition: all 0.3s;
        }
        
        .share-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* Version History */
        .version-item {
            border-right: 2px solid var(--border);
            padding-right: 20px;
            margin-right: 10px;
            position: relative;
            padding-bottom: 20px;
        }
        
        .version-item::before {
            content: '';
            position: absolute;
            right: -6px;
            top: 0;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
        }
        
        .version-item:last-child {
            border-right: none;
        }
    </style>
<base target="_blank">
</head>
<body class="hero-pattern">

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass-effect border-b border-slate-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="w-10 h-10 icon-container rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/30">
                        <i class="fas fa-mobile-alt text-xl text-white"></i>
                    </div>
                    <span class="text-2xl font-bold gradient-text">App Store</span>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button onclick="shareApp()" class="share-btn tooltip" title="مشاركة">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    <a href="index.html" class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-200 transition border border-slate-600 flex items-center text-sm">
                        <i class="fas fa-arrow-right ml-2"></i> العودة للمتجر
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-20 pb-10 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
        
        <!-- Loading State -->
        <div id="loadingState" class="flex justify-center items-center min-h-[60vh]">
            <div class="loading-spinner"></div>
        </div>

        <!-- App Details -->
        <div id="appDetails" class="hidden fade-in">
            <!-- Content will be loaded here -->
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden text-center py-20">
            <div class="w-24 h-24 mx-auto mb-4 bg-red-500/10 rounded-full flex items-center justify-center border border-red-500/30">
                <i class="fas fa-exclamation-triangle text-4xl text-red-400"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2 text-slate-200">التطبيق غير موجود</h2>
            <p class="text-slate-400 mb-6">عذراً، لم نتمكن من العثور على التطبيق المطلوب</p>
            <a href="index.html" class="btn-primary px-6 py-3 rounded-lg inline-block">
                العودة للمتجر
            </a>
        </div>

    </main>

    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black/95 hidden items-center justify-center z-50" onclick="closeImageModal()">
        <button class="absolute top-4 right-4 text-white text-2xl hover:text-red-400 transition">
            <i class="fas fa-times"></i>
        </button>
        <img id="modalImage" src="" class="max-w-90vw max-h-90vh rounded-lg shadow-2xl">
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: 'AIzaSyBqIOpQxyoR2t3WXfkLSq161ts7htQfHMo',
            authDomain: 'update-c4abc.firebaseapp.com',
            databaseURL: 'https://update-c4abc-default-rtdb.firebaseio.com',
            projectId: 'update-c4abc',
            storageBucket: 'update-c4abc.firebasestorage.app',
            messagingSenderId: '771065562119',
            appId: '1:771065562119:android:a9fd4d88071a771f6e96a2'
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let currentApp = null;
        let currentAppId = null;

        // Get App ID from URL
        function getAppId() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }

        // Load App Details
        function loadAppDetails() {
            const appId = getAppId();
            const loadingState = document.getElementById('loadingState');
            const appDetails = document.getElementById('appDetails');
            const errorState = document.getElementById('errorState');

            if (!appId) {
                loadingState.style.display = 'none';
                errorState.classList.remove('hidden');
                return;
            }

            currentAppId = appId;

            database.ref(`apps/${appId}`).once('value').then((snapshot) => {
                const app = snapshot.val();
                loadingState.style.display = 'none';

                if (!app) {
                    errorState.classList.remove('hidden');
                    return;
                }

                // Add dynamic data
                currentApp = {
                    ...app,
                    id: appId,
                    downloads: app.downloads || Math.floor(Math.random() * 50000) + 1000,
                    rating: app.rating || (Math.random() * 1.5 + 3.5).toFixed(1),
                    reviews: app.reviews || Math.floor(Math.random() * 5000) + 100,
                    version: app.version || '1.0.0',
                    updateDate: app.updateDate || new Date().toLocaleDateString('ar-SA'),
                    screenshots: app.screenshots || [app.screenshot, app.screenshot, app.screenshot],
                    ratingDistribution: app.ratingDistribution || generateRandomDistribution()
                };

                renderAppDetails(currentApp);
                appDetails.classList.remove('hidden');
                incrementViews(appId);
            }).catch((error) => {
                loadingState.style.display = 'none';
                errorState.classList.remove('hidden');
                console.error(error);
            });
        }

        // Generate Random Rating Distribution
        function generateRandomDistribution() {
            const total = 100;
            const five = Math.floor(Math.random() * 40) + 40;
            const four = Math.floor(Math.random() * 20) + 20;
            const three = Math.floor(Math.random() * 15) + 5;
            const two = Math.floor(Math.random() * 10) + 2;
            const one = total - five - four - three - two;
            return { 5: five, 4: four, 3: three, 2: two, 1: one };
        }

        // Increment Views
        function incrementViews(appId) {
            const viewsRef = database.ref(`apps/${appId}/views`);
            viewsRef.transaction((current) => (current || 0) + 1);
        }

        // Increment Downloads
        function incrementDownloads() {
            if (!currentAppId) return;
            
            const downloadsRef = database.ref(`apps/${currentAppId}/downloads`);
            downloadsRef.transaction((current) => (current || 0) + 1);
            
            // Show success message
            showToast('جاري تحميل التطبيق...', 'success');
        }

        // Render App Details
        function renderAppDetails(app) {
            const container = document.getElementById('appDetails');
            
            const stars = generateStars(app.rating);
            const ratingBars = generateRatingBars(app.ratingDistribution);
            
            container.innerHTML = `
                <!-- Screenshot Hero -->
                <div class="relative h-64 md:h-96 rounded-2xl overflow-hidden mb-8 screenshot-container border border-slate-700">
                    <img src="${app.screenshot}" alt="${app.name}" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/1200x600/1e293b/475569?text=No+Screenshot'">
                    <div class="absolute bottom-4 left-4 right-4 flex justify-between items-end">
                        <div class="glass-effect px-4 py-2 rounded-lg">
                            <span class="text-sm text-slate-300">الإصدار ${app.version}</span>
                        </div>
                        <div class="glass-effect px-4 py-2 rounded-lg">
                            <span class="text-sm text-slate-300">تم التحديث ${app.updateDate}</span>
                        </div>
                    </div>
                </div>

                <!-- Screenshot Gallery -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold mb-4 text-slate-200">معرض الصور</h3>
                    <div class="screenshot-gallery">
                        ${app.screenshots.map((src, idx) => `
                            <div class="screenshot-thumb" onclick="openImageModal('${src}')">
                                <img src="${src}" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/200x120/1e293b/475569?text=Screenshot'">
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Main Info -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Header -->
                        <div class="glass-effect rounded-2xl p-6 border border-slate-700">
                            <div class="flex flex-col md:flex-row items-start md:items-center gap-6">
                                <img src="${app.icon}" alt="${app.name}" class="w-24 h-24 md:w-32 md:h-32 rounded-2xl shadow-2xl border-4 border-slate-700" onerror="this.src='https://via.placeholder.com/128/1e293b/475569?text=App'">
                                <div class="flex-1">
                                    <h1 class="text-3xl md:text-4xl font-bold mb-2 text-slate-100">${app.name}</h1>
                                    <p class="text-slate-400 text-lg mb-4">${app.developer}</p>
                                    <div class="flex flex-wrap gap-3 mb-4">
                                        <span class="badge px-4 py-2 rounded-full text-sm font-bold flex items-center">
                                            <i class="fas fa-weight-hanging ml-2"></i> ${app.size}
                                        </span>
                                        <span class="badge-secondary px-4 py-2 rounded-full text-sm font-bold flex items-center">
                                            <i class="fas fa-download ml-2"></i> ${formatNumber(app.downloads)} تحميل
                                        </span>
                                        <span class="bg-green-500/20 text-green-400 border border-green-500/30 px-4 py-2 rounded-full text-sm font-bold flex items-center">
                                            <i class="fas fa-shield-alt ml-2"></i> آمن
                                        </span>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <div class="stars text-lg">${stars}</div>
                                        <span class="text-slate-300 font-bold">${app.rating}</span>
                                        <span class="text-slate-500">(${formatNumber(app.reviews)} تقييم)</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="glass-effect rounded-2xl p-6 border border-slate-700">
                            <h2 class="text-xl font-bold mb-4 flex items-center text-slate-200">
                                <i class="fas fa-align-right ml-2 text-blue-400"></i>
                                الوصف
                            </h2>
                            <div id="descriptionText" class="text-slate-300 leading-relaxed text-lg whitespace-pre-line line-clamp-6">
                                ${app.description}
                            </div>
                            <button onclick="toggleDescription()" id="readMoreBtn" class="mt-4 text-blue-400 hover:text-blue-300 text-sm font-bold">
                                قراءة المزيد <i class="fas fa-chevron-down mr-1"></i>
                            </button>
                        </div>

                        <!-- Rating Distribution -->
                        <div class="glass-effect rounded-2xl p-6 border border-slate-700">
                            <h2 class="text-xl font-bold mb-4 flex items-center text-slate-200">
                                <i class="fas fa-chart-bar ml-2 text-yellow-400"></i>
                                توزيع التقييمات
                            </h2>
                            ${ratingBars}
                        </div>

                        <!-- Features -->
                        <div class="glass-effect rounded-2xl p-6 border border-slate-700">
                            <h2 class="text-xl font-bold mb-4 flex items-center text-slate-200">
                                <i class="fas fa-star ml-2 text-yellow-400"></i>
                                مميزات التطبيق
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${generateFeatures()}
                            </div>
                        </div>

                        <!-- Version History -->
                        <div class="glass-effect rounded-2xl p-6 border border-slate-700">
                            <h2 class="text-xl font-bold mb-4 flex items-center text-slate-200">
                                <i class="fas fa-history ml-2 text-purple-400"></i>
                                سجل التحديثات
                            </h2>
                            <div class="version-item">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-slate-200">الإصدار ${app.version}</h4>
                                    <span class="text-sm text-slate-500">${app.updateDate}</span>
                                </div>
                                <p class="text-slate-400 text-sm">تحديث جديد يتضمن إصلاحات للأخطاء وتحسينات في الأداء</p>
                            </div>
                            <div class="version-item">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-slate-200">الإصدار ${(parseFloat(app.version) - 0.1).toFixed(1)}</h4>
                                    <span class="text-sm text-slate-500">منذ شهر</span>
                                </div>
                                <p class="text-slate-400 text-sm">إضافة ميزات جديدة وتحسين واجهة المستخدم</p>
                            </div>
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Download Card -->
                        <div class="glass-effect rounded-2xl p-6 sticky top-24 border border-slate-700">
                            <h3 class="text-lg font-bold mb-4 text-slate-200">معلومات التحميل</h3>
                            <div class="space-y-4 mb-6">
                                <div class="flex justify-between py-3 border-b border-slate-700">
                                    <span class="text-slate-400">المطور</span>
                                    <span class="font-medium text-slate-200">${app.developer}</span>
                                </div>
                                <div class="flex justify-between py-3 border-b border-slate-700">
                                    <span class="text-slate-400">الحجم</span>
                                    <span class="font-medium text-slate-200">${app.size}</span>
                                </div>
                                <div class="flex justify-between py-3 border-b border-slate-700">
                                    <span class="text-slate-400">الإصدار</span>
                                    <span class="font-medium text-slate-200">${app.version}</span>
                                </div>
                                <div class="flex justify-between py-3 border-b border-slate-700">
                                    <span class="text-slate-400">التحديث</span>
                                    <span class="font-medium text-slate-200">${app.updateDate}</span>
                                </div>
                                <div class="flex justify-between py-3">
                                    <span class="text-slate-400">التوافق</span>
                                    <span class="font-medium text-slate-200">Android 5.0+</span>
                                </div>
                            </div>
                            
                            <a href="${app.downloadUrl}" target="_blank" onclick="incrementDownloads()"
                               class="block w-full btn-primary text-center py-4 rounded-xl font-bold text-lg transition transform hover:scale-[1.02] shadow-lg shadow-blue-500/30 mb-4">
                                <i class="fas fa-download ml-2"></i> تحميل التطبيق الآن
                            </a>
                            
                            <div class="flex justify-center gap-3 mb-4">
                                <button onclick="shareApp('twitter')" class="share-btn">
                                    <i class="fab fa-twitter"></i>
                                </button>
                                <button onclick="shareApp('facebook')" class="share-btn">
                                    <i class="fab fa-facebook-f"></i>
                                </button>
                                <button onclick="shareApp('whatsapp')" class="share-btn">
                                    <i class="fab fa-whatsapp"></i>
                                </button>
                                <button onclick="copyLink()" class="share-btn" title="نسخ الرابط">
                                    <i class="fas fa-link"></i>
                                </button>
                            </div>
                            
                            <p class="text-center text-xs text-slate-500">
                                <i class="fas fa-shield-alt ml-1"></i>
                                تم التحقق من الأمان
                            </p>
                        </div>

                        <!-- Similar Apps -->
                        <div class="glass-effect rounded-2xl p-6 border border-slate-700">
                            <h3 class="text-lg font-bold mb-4 text-slate-200">تطبيقات مشابهة</h3>
                            <div id="similarApps" class="space-y-3">
                                <div class="text-center text-slate-500 py-4">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Load similar apps
            loadSimilarApps(app.category, app.id);
        }

        // Generate Stars
        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= Math.floor(rating)) {
                    stars += '<i class="fas fa-star"></i>';
                } else if (i === Math.ceil(rating) && !Number.isInteger(rating)) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            return stars;
        }

        // Generate Rating Bars
        function generateRatingBars(distribution) {
            return Object.entries(distribution).sort((a, b) => b[0] - a[0]).map(([star, percentage]) => `
                <div class="rating-bar">
                    <div class="rating-stars">${star} <i class="fas fa-star"></i></div>
                    <div class="rating-progress">
                        <div class="rating-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div class="text-slate-400 text-sm min-w-[40px]">${percentage}%</div>
                </div>
            `).join('');
        }

        // Generate Features
        function generateFeatures() {
            const features = [
                'واجهة مستخدم سهلة الاستخدام',
                'أداء سريع وسلس',
                'دعم كامل للغة العربية',
                'تحديثات مستمرة',
                'أمان وحماية للبيانات',
                'دعم فني على مدار الساعة'
            ];
            
            return features.map(feature => `
                <div class="flex items-center space-x-3 space-x-reverse">
                    <div class="w-10 h-10 rounded-full feature-icon flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-check"></i>
                    </div>
                    <span class="text-slate-300">${feature}</span>
                </div>
            `).join('');
        }

        // Toggle Description
        function toggleDescription() {
            const desc = document.getElementById('descriptionText');
            const btn = document.getElementById('readMoreBtn');
            
            if (desc.classList.contains('line-clamp-6')) {
                desc.classList.remove('line-clamp-6');
                btn.innerHTML = 'عرض أقل <i class="fas fa-chevron-up mr-1"></i>';
            } else {
                desc.classList.add('line-clamp-6');
                btn.innerHTML = 'قراءة المزيد <i class="fas fa-chevron-down mr-1"></i>';
            }
        }

        // Load Similar Apps
        function loadSimilarApps(category, currentId) {
            const container = document.getElementById('similarApps');
            
            database.ref('apps').limitToLast(5).once('value').then((snapshot) => {
                const apps = snapshot.val();
                if (!apps) {
                    container.innerHTML = '<p class="text-slate-500 text-center">لا توجد تطبيقات مشابهة</p>';
                    return;
                }
                
                const similarApps = Object.entries(apps)
                    .filter(([id]) => id !== currentId)
                    .slice(0, 3);
                
                if (similarApps.length === 0) {
                    container.innerHTML = '<p class="text-slate-500 text-center">لا توجد تطبيقات مشابهة</p>';
                    return;
                }
                
                container.innerHTML = similarApps.map(([id, app]) => `
                    <div class="similar-app-card flex items-center gap-3" onclick="window.location.href='app.html?id=${id}'">
                        <img src="${app.icon}" class="w-12 h-12 rounded-lg object-cover" onerror="this.src='https://via.placeholder.com/48/1e293b/475569?text=App'">
                        <div class="flex-1 min-w-0">
                            <h4 class="font-bold text-slate-200 text-sm truncate">${app.name}</h4>
                            <p class="text-slate-500 text-xs">${app.developer}</p>
                        </div>
                        <span class="text-slate-400 text-xs">${app.size}</span>
                    </div>
                `).join('');
            });
        }

        // Format Number
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        // Share App
        function shareApp(platform) {
            const url = window.location.href;
            const text = `تفقد هذا التطبيق الرائع: ${currentApp?.name || ''}`;
            
            let shareUrl = '';
            switch(platform) {
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
                    break;
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                    break;
                case 'whatsapp':
                    shareUrl = `https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`;
                    break;
                default:
                    shareApp();
                    return;
            }
            
            window.open(shareUrl, '_blank');
        }

        // Copy Link
        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                showToast('تم نسخ الرابط!');
            });
        }

        // Image Modal
        function openImageModal(src) {
            document.getElementById('modalImage').src = src;
            document.getElementById('imageModal').classList.remove('hidden');
            document.getElementById('imageModal').classList.add('flex');
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.add('hidden');
            document.getElementById('imageModal').classList.remove('flex');
        }

        // Toast Notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-emerald-600' : 'bg-blue-600'
            } text-white border border-white/20`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadAppDetails();
        });
    </script>
</body>
</html>